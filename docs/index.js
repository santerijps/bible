function u(n){let e=document.querySelector(n);if(e===null)throw Error(`Element not found with selector: ${n}`);return e}async function p(n,e,t){let r=t??n.name;console.time(r);let c=await n(...e??[]);return console.timeEnd(r),c}function m(n,e){let t;return(...r)=>{clearTimeout(t),t=setTimeout(()=>n(...r),e)}}function f(n,e){switch(n){case"en":return`${e.book}, chapter ${e.chapter}`;case"fi":return`${e.book}, ${e.chapter}. luku`}}var d=class{parentElement;createChild;updateChild;beforeUpdateChild;cache;garbage;constructor(e,t,r,c){this.parentElement=e,this.createChild=t,this.updateChild=r,this.beforeUpdateChild=c,this.cache=[],this.garbage=[]}emptyTrash(){for(let e of this.garbage)e.remove()}update(e){this.emptyTrash();for(let t=0;t<e.length;t++){let r;if(t>=this.cache.length?(r=this.createChild(),this.cache.push(r),this.parentElement.appendChild(r.element)):r=this.cache[t],this.beforeUpdateChild){let c=this.beforeUpdateChild(r,e[t],e,t);c&&this.garbage.push(c)}this.updateChild(r,e[t],e,t),r.element.hidden=!1}for(let t=e.length;t<this.cache.length;t++){let{element:r}=this.cache[t];r.hidden=!0}}};function y(){let n=u("#query-input"),e=u("#query-output"),t=u(".loader"),r=new Worker("./worker.js",{type:"module"});r.addEventListener("message",o=>{switch(o.data.type){case"loader":o.data.isLoading?t.hidden=!1:t.hidden=!0;break;case"query":p(b,[o.data.results],"render");break}});let c=new d(e,()=>{let o=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td");return o.append(a,s),{element:o,refs:{refTd:a,txtTd:s}}},(o,a)=>{o.refs.refTd.innerText=a.chapter+":"+a.verse,o.refs.txtTd.innerText=a.text},(o,a,s,i)=>{let g=i===0?"":s[i-1].book,E=i===0?"":s[i-1].chapter;if(a.book!==g||a.chapter!==E){let l=document.createElement("tr"),h=document.createElement("th");return h.colSpan=2,h.role="rowheader",h.innerText=f("fi",a),l.appendChild(h),o.element.insertAdjacentElement("beforebegin",l),l}}),b=o=>new Promise(a=>{c.update(o),a()});n.addEventListener("input",m(()=>{r.postMessage({query:n.value})},100))}y();
