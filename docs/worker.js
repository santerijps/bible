async function g(e){let s=await(await fetch(`data/${e}.txt`)).text();return L(s)}function L(e){let t=e.split(`
`),s=[];t.pop();let n="",o="",r="",a=1,i=1;for(let c of t)if(c.startsWith(";")){let[M,y,E,S]=c.split(";");n=y,o=E,r=S,a=1,i=1}else c.startsWith("+")?(a+=1,i=1):(s.push({id:n,alias:r,book:o,chapter:a.toString(),verse:i.toString(),text:c}),i+=1);return s}var u=class e{idb;upgradeNeeded;constructor(t,s){this.idb=t,this.upgradeNeeded=s}static open(t,s){return new Promise((n,o)=>{let r=indexedDB.open(t,s);r.addEventListener("success",()=>{let a=new e(r.result,!1);n(a)}),r.addEventListener("upgradeneeded",()=>{let a=new e(r.result,!0);n(a)}),r.addEventListener("error",a=>{o(a)})})}close(){this.idb.close()}createObjectStore(t,s){return new Promise((n,o)=>{let r=this.idb.createObjectStore(t,s).transaction;r.addEventListener("complete",()=>n()),r.addEventListener("error",a=>o(a))})}put(t,s){return new Promise((n,o)=>{let r=this.idb.transaction([t],"readwrite"),a=r.objectStore(t);for(let i of s)a.put(i);r.addEventListener("complete",()=>n()),r.addEventListener("error",i=>o(i))})}getAll(t){return new Promise((s,n)=>{let r=this.idb.transaction([t],"readonly").objectStore(t).getAll();r.addEventListener("success",()=>s(r.result)),r.addEventListener("error",a=>n(a))})}forEach(t,s){let o=this.idb.transaction([t],"readonly").objectStore(t).openCursor();o.addEventListener("success",()=>{let r=o.result;r&&(s(r.value),r.continue())})}filter(t,s){return new Promise((n,o)=>{let r=this.idb.transaction([t],"readonly"),a=r.objectStore(t).openCursor(),i=[];a.addEventListener("success",()=>{let c=a.result;c&&(s(c.value)&&i.push(c.value),c.continue())}),r.addEventListener("complete",()=>n(i)),r.addEventListener("error",c=>o(c))})}};var l=class e{idbm;objectStoreName;constructor(t,s){this.idbm=t,this.objectStoreName=s}static async create(t,s,n){return t.idb.objectStoreNames.contains(s)||await t.createObjectStore(s,n),new e(t,s)}put(t){return this.idbm.put(this.objectStoreName,t)}getAll(){return this.idbm.getAll(this.objectStoreName)}forEach(t){this.idbm.forEach(this.objectStoreName,t)}filter(t){return this.idbm.filter(this.objectStoreName,t)}};var f=class{text;index;savedIndex;constructor(t,s=0,n=0){this.text=t,this.index=s,this.savedIndex=n}eof(){return this.index>=this.text.length}read(){return this.eof()?null:this.text[this.index++]}peek(){return this.eof()?null:this.text[this.index]}next(){this.eof()||(this.index+=1)}save(){this.savedIndex=this.index}load(){return this.text.slice(this.savedIndex,this.index)}};function A(e){let t={},s=I(e).trim();x(e),s.length>0&&(t.book=s);let n=P(e).trim();x(e),n.length>0&&(t.chapter=n);let o=Array();for(;!e.eof();){let a=j(e);if(a===null)break;o.push(a)}o.length>0&&(t.verses=o),x(e);let r=C(e);return r.length>0&&(t.text=r),t}function C(e){let t=!1;for(e.save();!e.eof();){let s=e.peek();if(t&&s==='"')break;if(!t)if(s==='"'){t=!0,e.next(),e.save();continue}else break;e.next()}return e.load()}function I(e){for(e.save();!e.eof();){let s=e.peek().charCodeAt(0);if(p(s)&&e.load().length>0||!q(s)&&!p(s)&&!b(s))break;e.next()}return e.load()}function P(e){for(e.save();!e.eof();){let s=e.peek().charCodeAt(0);if(Q(s)){let n=e.load();return e.next(),n}if(!p(s))break;e.next()}return e.load()}function j(e){let t={};for(e.save();!e.eof();){let n=e.peek().charCodeAt(0);if(p(n)||b(n)){e.next();continue}if(D(n)){t.from=parseInt(e.load().trim()),e.next(),e.save();continue}if(N(n)){t.to=parseInt(e.load().trim()),e.next();break}if(t.from===void 0)return null;break}if(t.from===void 0){let s=parseInt(e.load().trim());t.from=s}else if(t.to===void 0){let s=parseInt(e.load().trim());t.to=s}return t}function x(e){for(;!e.eof();){let s=e.peek().charCodeAt(0);if(!b(s))break;e.next()}}var q=e=>97<=e&&e<=122||e===196||e===214||e===228||e===246,p=e=>48<=e&&e<=57,b=e=>e===32,Q=e=>e===58,D=e=>e===45,N=e=>e===44;function w(e){let t=e.toLowerCase().split(";").map(n=>n.trim()).filter(n=>n.length>0),s=Array();for(let n of t){let o=new f(n),r=A(o);if(r===null)break;s.push(r)}return s}function v(e,t){let s=w(t),n=[];for(let o of s){let r=e.filter(a=>B(a,o));n=[...n,...r]}return n}function B(e,t){if(t.book&&!(e.book.toLowerCase().startsWith(t.book)||e.alias.toLowerCase().startsWith(t.book))||t.chapter&&e.chapter!==t.chapter)return!1;if(t.verses){let s=!1;for(let n of t.verses){let o=parseInt(e.verse);if(n.to){if(n.from<=o&&o<=n.to){s=!0;break}}else if(o===n.from){s=!0;break}}if(!s)return!1}return!(t.text&&!e.text.toLowerCase().includes(t.text))}async function d(e,t,s){let n=s??e.name;console.time(n);let o=await e(...t??[]);return console.timeEnd(n),o}self.postMessage({type:"loader",isLoading:!0});var k=await d(u.open,["PassageDB"],"open"),m=await l.create(k,"fin-33-38",{autoIncrement:!0}),h=[];k.upgradeNeeded?(h=await d(g,["fin-33-38"],"fetch"),await d(m.put.bind(m),[h],"put")):h=await d(m.getAll.bind(m),[],"load");self.postMessage({type:"loader",isLoading:!1});self.postMessage({type:"query",results:v(h,"genesis")});self.addEventListener("message",e=>{let t=v(h,e.data.query);self.postMessage({type:"query",results:t})});
